<!-- mdc-tier2.html - MDC Tier 2 Secure Logic Review -->
<!--
  Summary:
  MDC Tier 2 enables logic promotion from Tier 1. This interface includes
  auto-loaded verified logic, editing, re-validation, and export to Tier 3 review queue.
  NDA token still required but logic must also be flagged as "admin-approved" in localStorage.
-->

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDC Tier 2 Logic Review</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/scripts/mdc-validator.js"></script>
</head>
<body class="bg-gray-950 text-gray-100">
  <div id="header"></div>

  <main class="p-6 max-w-4xl mx-auto">
    <section id="accessDenied" class="hidden p-6 bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-400 rounded">
      <h2 class="text-xl font-bold">Access Denied</h2>
      <p class="mt-2">You must have an NDA Token and approved Tier 1 logic to access this review panel.</p>
    </section>

    <section id="tier2Interface" class="hidden">
      <h1 class="text-3xl font-bold text-indigo-400 mb-4">MDC Tier 2: Logic Promotion Review</h1>
      <p class="text-gray-400 mb-6">Edit and revalidate logic blueprints approved in Tier 1 before submitting to Tier 3 reviewers.</p>

      <div class="p-4 mb-6 border border-gray-700 rounded bg-gray-900">
        <h2 class="text-xl font-semibold text-indigo-500">Blueprint Logic</h2>
        <textarea id="tier2LogicArea" rows="12"
          class="w-full p-2 border border-gray-700 rounded bg-gray-800 text-white font-mono"></textarea>
        <div class="flex space-x-4 mt-4">
          <button onclick="validateBlueprintInput('tier2LogicArea', 'tier2Validator')"
            class="bg-indigo-600 text-white px-4 py-2 rounded">Revalidate</button>
          <button onclick="submitToTier3()"
            class="bg-green-600 text-white px-4 py-2 rounded">Submit to Tier 3</button>
        </div>
        <div id="tier2Validator" class="mt-4 text-sm"></div>
      </div>
    </section>
  </main>

  <div id="footer"></div>

  <script>
    // Inject header/footer
    fetch('/metaldrug.com/includes/header.html').then(r => r.text()).then(d => document.getElementById('header').innerHTML = d);
    fetch('/metaldrug.com/includes/footer.html').then(r => r.text()).then(d => document.getElementById('footer').innerHTML = d);

    // Load and check token + Tier 1 approval
    window.addEventListener('DOMContentLoaded', () => {
      const token = sessionStorage.getItem('nda_token');
      const logic = localStorage.getItem('approved_tier1_logic');
      if (token && logic) {
        document.getElementById('tier2Interface').classList.remove('hidden');
        document.getElementById('tier2LogicArea').value = logic;
      } else {
        document.getElementById('accessDenied').classList.remove('hidden');
      }
    });

    function submitToTier3() {
      const logic = document.getElementById('tier2LogicArea').value;
      if (!logic.trim()) {
        alert("Cannot submit empty logic.");
        return;
      }
      const now = new Date().toISOString();
      localStorage.setItem('submitted_tier2_logic', JSON.stringify({ content: logic, timestamp: now }));
      alert("Logic submitted to Tier 3 reviewers.");
    }
  </script>
</body>
</html>
