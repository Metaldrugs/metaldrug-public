<!-- review_tier2_submissions.html (MDC Tier 2 Review Interface) -->
<!--
Summary:
- Displays submissions from mdc-tier2/tier2_submissions.csv
- Allows approval/rejection
- Sends notification via process_tier2_review.php
-->

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDC Tier 2 - Review Submissions</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-gray-100">
  <div id="header"></div>

  <main class="p-6 max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-indigo-400 mb-6">MDC Tier 2 Submission Review</h1>
    <p class="text-gray-400 mb-4">Admin panel to review submitted blueprints and approve or reject Tier 2 access.</p>

    <div id="reviewTable" class="space-y-6"></div>
  </main>

  <div id="footer"></div>

  <script>
    // Header/footer injection
    fetch('/metaldrug.com/includes/header.html').then(res => res.text()).then(data => document.getElementById('header').innerHTML = data);
    fetch('/metaldrug.com/includes/footer.html').then(res => res.text()).then(data => document.getElementById('footer').innerHTML = data);

    // Load CSV submissions and render
    fetch('tier2_submissions.csv')
      .then(res => res.text())
      .then(csv => {
        const rows = csv.trim().split('\n').slice(1);
        const table = document.getElementById('reviewTable');
        rows.forEach((row, idx) => {
          const [timestamp, name, email, blueprint, status] = row.split(',');
          const card = document.createElement('div');
          card.className = 'border border-gray-700 rounded p-4 bg-gray-900';
          card.innerHTML = `
            <p><strong>Name:</strong> ${name}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Submitted:</strong> ${timestamp}</p>
            <p class="mt-2"><strong>Blueprint:</strong></p>
            <pre class="bg-black text-green-400 text-xs p-2 rounded overflow-auto max-h-48">${blueprint}</pre>
            <p class="mt-2"><strong>Status:</strong> ${status}</p>
            <div class="flex space-x-4 mt-4">
              <button onclick="review(${idx}, 'approved')" class="bg-green-600 text-white px-4 py-1 rounded">Approve</button>
              <button onclick="review(${idx}, 'rejected')" class="bg-red-600 text-white px-4 py-1 rounded">Reject</button>
            </div>
          `;
          table.appendChild(card);
        });
      });

    // Review action
    function review(index, action) {
      fetch('/metaldrug.com/scripts/process_tier2_review.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ index, action, module: 'mdc' })
      })
        .then(res => res.text())
        .then(msg => alert(msg))
        .catch(() => alert('Review failed.'));
    }
  </script>
</body>
</html>
