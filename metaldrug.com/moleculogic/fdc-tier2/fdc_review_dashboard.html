<!-- fdc_review_dashboard.html -->
<!-- Summary:
Admin dashboard to review FDC Tier 2 submissions. Enables status updates and sends automated emails via backend logic.
-->

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FDC Tier 2 Submission Review</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-gray-100 font-sans">
  <div id="header"></div>

  <main class="p-6 max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-indigo-400 mb-6">FDC Tier 2 Submissions: Admin Review Panel</h1>

    <table class="w-full border border-gray-700 mb-10">
      <thead class="bg-gray-800 text-gray-200">
        <tr>
          <th class="p-2">Timestamp</th>
          <th class="p-2">Name</th>
          <th class="p-2">Email</th>
          <th class="p-2">Status</th>
          <th class="p-2">Notes</th>
          <th class="p-2">Actions</th>
        </tr>
      </thead>
      <tbody id="submissionTable" class="text-sm text-gray-300 bg-gray-900"></tbody>
    </table>
  </main>

  <div id="footer"></div>

  <script>
    // Load header and footer
    fetch('/metaldrug.com/includes/header.html').then(res => res.text()).then(data => document.getElementById('header').innerHTML = data);
    fetch('/metaldrug.com/includes/footer.html').then(res => res.text()).then(data => document.getElementById('footer').innerHTML = data);

    // Load and render submission table
    async function loadSubmissions() {
      const res = await fetch('fdc_submissions.csv');
      const text = await res.text();
      const lines = text.trim().split('\n').slice(1); // Skip header

      const tbody = document.getElementById('submissionTable');
      tbody.innerHTML = '';

      lines.forEach(line => {
        const [id, timestamp, name, email, status, note] = line.split(',');

        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="p-2">${timestamp}</td>
          <td class="p-2">${name}</td>
          <td class="p-2">${email}</td>
          <td class="p-2">${status}</td>
          <td class="p-2">${note || ''}</td>
          <td class="p-2 space-x-2">
            <button onclick="review('${id}', 'approved')" class="bg-green-600 px-2 py-1 rounded text-white">Approve</button>
            <button onclick="review('${id}', 'rejected')" class="bg-red-600 px-2 py-1 rounded text-white">Reject</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function review(submissionId, status) {
      const notes = prompt(`Enter review notes for ${status.toUpperCase()} status:`) || '';
      const res = await fetch('update_submission_status.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ submission_id: submissionId, status, notes })
      });

      const result = await res.text();
      alert(result);
      loadSubmissions();
    }

    loadSubmissions();
  </script>
</body>
</html>
